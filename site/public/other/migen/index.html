<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Getting started with Migen | A python based HDL | Utkarsh M</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <header class="site-title-main">
      Utkarsh M
    </header>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="post-container">
  <div class="post-date">2021/03/01</div>
  <h1 class="post-title">Getting started with Migen | A python based HDL</h1>
</div>

<main>
<p>In digital design, the complexity of designing a circuit gave birth to standard languages to describe digital circuits (i.e. Hardware Description Languages - HDL). HDLs are used to model hardware elements very concurrently. Verilog HDL and VHDL are the most popular HDLs.</p>
<p>Digital circuits are described at Registers Transfer Level (RTL) using HDL. Then logic synthesis tool will generate details of gates and interconnection to implement courses. This synthesized result can be used for fabrication by having placement and routing components, and later its functionality can be verified using simulation.</p>
<p>Since the creation of traditional hardware descriptive languages(HDL) like Verilog and VHDL, there have not been many improvements.
They are old and provide a nonintuitive way to design hardware.</p>
<p>Migen, on the other hand, created by M-Labs, is easier to learn and use.
It reduces syntax and helps to reduce error-prone by automating things like reset, allowing fast hardware prototyping.</p>
<p>In this blog, We will go through the steps of installing Migen on Linux, running a bare code for OR gate, and later see some fundamental basics of Migen.</p>
<h2 id="installation">Installation</h2>
<p>We will be installing Migen on Linux. As Migen is a based on Python,
It is necessary to have Python installed.
Python can be easily installed on Linux with respective package managers like Pacman or apt-get.</p>
<p>We will first clone Migen&rsquo;s Git repository, Then Install it with Python3.</p>
<pre><code class="language-bash">  git clone http://github.com/m-labs/migen
  cd migen
  python3 ./setup.py develop --user
</code></pre>
<h2 id="getting-started-with-migen">Getting Started With Migen</h2>
<p>Basic Principle: We use migen to create a list of combinatorial and synchronous Assignments.</p>
<p>Like</p>
<pre><code class="language-python"># for Combinational
self.comb += []
# for Synchronous
self.sync += []
</code></pre>
<p>each hardware module(in cotnext of Verilog) here is a Module object instatiated as a class.
So we can declare IO etc anywhere in the module(class) declaration.</p>
<p>subModules can be added to the current module with.</p>
<pre><code class="language-python">my_submodule = MySubmodule()
self.submodules +=my_submodule
</code></pre>
<p>The Top Module can be converted into Verilog code with</p>
<pre><code class="language-python">verilog.convert()
</code></pre>
<p>Signals (Registers /Wires) can be declared with</p>
<pre><code class="language-python">Signal(nbits)
#dont forget self. in actual code.
</code></pre>
<p>If we assign this to a sync list, then the signal becomes a register. like here</p>
<pre><code class="language-python">counter = signal(26);
self.sync += counter.eq(counter +1)
</code></pre>
<p>if we assign signal to a comb list, then it acts like a wire. like here:</p>
<pre><code class="language-python">counter = signal(26);
self.comb += led.eq(counter[25])
</code></pre>
<h4 id="in-migen-all-assignments-in-sync-are-effective-on-a-rising-edge-of-the-clock">In Migen, All assignments in sync are effective on a rising edge of the clock.</h4>
<p>By default, If we just use self.sync.
the end design will have a single clock but if multiple clocks are required
then they can be setup.</p>
<h2 id="usageexample">Usage/Example</h2>
<p>To design a circuit with Migen, We will create a python file and code a simple combinational circuit( OR gate )
and see how it compares to the later generated Verilog Code.</p>
<h3 id="or-gate-module">OR Gate Module</h3>
<pre><code class="language-python">from migen import *

class ORGate(Module):
  def __init__(self):
    self.a = Signal()
    self.b = Signal()
    self.x = Signal()

    ###

    self.comb += self.x.eq(self.a | self.b)

dut = ORGate()
</code></pre>
<h3 id="testbench-for-the-module">Testbench for the Module.</h3>
<pre><code class="language-python">def testbench():
  yield dut.a.eq(0)
  yield dut.b.eq(0)
  yield
  assert (yield dut.x) == 0

  yield dut.a.eq(0)
  yield dut.b.eq(1)
  yield
  assert (yield dut.x) == 1

</code></pre>
<h3 id="for-simulation-writing-outputs-to-a-file">For Simulation (writing outputs to a file)</h3>
<pre><code class="language-python">run_simulation(dut, testbench(), vcd_name=&quot;file.vcd&quot;)
</code></pre>
<h3 id="converting-python-code-into-a-synthesizable-verilog-code">Converting Python Code into a synthesizable Verilog Code</h3>
<pre><code class="language-python">if __name__ == &quot;__main__&quot;:
  from migen.fhdl.verilog import convert
  convert(dut).write(&quot;my_design.v&quot;)
</code></pre>
<p>After having the code into a single file(ex- test.py). We can run it using python3 by using the following command.</p>
<pre><code class="language-bash">python3 test.py
</code></pre>
<h2 id="output-file-generated">Output File Generated</h2>
<h3 id="my_designv-verilog-code-generated">my_design.v (Verilog Code Generated)</h3>
<pre><code class="language-verilog">/* Machine-generated using Migen */
module top(

);

reg a = 1'd0;
reg b = 1'd0;
wire x;

// synthesis translate_off
reg dummy_s;
initial dummy_s &lt;= 1'd0;
// synthesis translate_on

assign x = (a | b);

endmodule

</code></pre>
<h3 id="simulation-log-file-generated-with-testbench-code">Simulation Log File generated with testbench code.</h3>
<pre><code>$scope module ORGate $end
$var wire 1 ! a $end
$var wire 1 &quot; b $end
$var wire 1 # x $end
$var wire 1 $ sys_clk $end
$enddefinitions $end
$dumpvars
$end
#0
0!
0&quot;
0#
0$
#5
1$
#10
0$
#15
1&quot;
1#
1$
#20
0$
#25
1$
0!
0&quot;
0#
0$

</code></pre>
<p>We can easily confirm the proper working of the python code By analyzing the output log file generated with the testbench inputs.</p>
<h2 id="conclusion">Conclusion</h2>
<p>From the generated Verilog file, We can see that the generated code is similar to what we would manually write.</p>
<p>In the case of Sequential complex code, Python takes care of stuff like reset and synchronization with the clock.
Migen gives the developer more time to work on the logic of the hardware while not having to deal with many of the restrictions that
are present while working with traditional Hardware Description Languages.</p>
<p>When Migen is used with tools like LiteX, which is also an open-source project/ It can be pretty powerful and directly implement our design onto SOCs and FPGAs.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://m-labs.hk/migen/manual/index.html">https://m-labs.hk/migen/manual/index.html</a></li>
<li><a href="https://github.com/enjoy-digital/litex">https://github.com/enjoy-digital/litex</a></li>
<li><a href="https://github.com/m-labs/migen">https://github.com/m-labs/migen</a></li>
</ul>

</main>

  <footer>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/math-code.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/render-katex.js" defer></script>

<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>

  
  <hr/>
  Â© <a href="https://yihui.org">Yihui Xie</a> 2017 &ndash; 2025 | <a href="https://github.com/yihui">Github</a> | <a href="https://twitter.com/xieyihui">Twitter</a>
  
  </footer>
  </body>
</html>

